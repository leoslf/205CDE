{% extends 'admin/base.html' %}

{% if bar is defined %}
    {% set result = query(table, desc=True, filter=dict(bar=bar)) %}
{% else %}
    {% set result = query(table, desc=True) %}
{% endif %}


{# transpose to get the column name only #}
{% set columns = list(zip(*result['description']))[0] %}

{% block article %}
    <div class="row">
        <header>
            <h1>{% block article_title %}{% endblock %}</h1>
        </header>
    </div>
    <div class="row">
        {% if result is not none %}
            <div class="row">
                <button id="addrow_btn" class="btn btn-default pull-right"><span class="glyphicon glyphicon-plus"></span> Add Row</button>
            </div>
            <div class="row">
                {% include 'errmsg.html' %}
                <!-- submitted rows generated in js -->
                <form method="POST" action="update_table">
                    <div class="table-responsive">
                        <table class="table table-striped" id="table">
                            <thead>
                                <tr>
                                    {% for col_name in columns %}
                                        <th>{{ col_name }}</th>
                                    {% endfor %}
                                </tr>
                            </thead>
                            <tbody>
                                {% for row in result['rows'] %}
                                    <tr>
                                        {% for col in row %}
                                            <td>{{ row[col] }}</td>
                                        {% endfor %}
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    <input type="hidden" name="table_name" value={{ table }} />
                    <button type="submit" class="btn btn-default">Submit</button>
                    <button type="reset" class="btn btn-default" onClick="window.location.reload()">Reset</button>
                </form>
            </div>
        {% else %}
            <script>
                set_cookie("errmsg", "result is None", 60);
                console.log(get_cookie("errmsg"));
            </script>
            {% include 'errmsg.html' %}
            <script>
                document.write("result: " + "{{ result }}");
                document.write("{{ columns }}");
            </script>
        {% endif %}
    </div>
    <script src="/editable_table.js"></script>
    <script>
        $('#table').editabletbl();
    </script>
{% endblock %}

